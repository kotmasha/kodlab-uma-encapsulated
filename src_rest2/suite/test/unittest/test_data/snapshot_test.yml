#This is the test script for testing existing snapshot endpoint
#Test CRUD functionality

create an agent:
  method: POST
  url: /UMA/object/agent
  status_code: 201
  data:
    agent_id: test_agent

create an snapshot without id:
  method: POST
  url: /UMA/object/snapshot
  status_code: 400
  message: Coming request is missing necessary fields
  data:
    agent_id: test_agent

create an snapshot with an invalid id(number):
  method: POST
  url: /UMA/object/snapshot
  status_code: 400
  message: Cannot parsing the field
  data:
    agent_id: test_agent
    snapshot_id: 123.45

create an snapshot without agent_id:
  method: POST
  url: /UMA/object/snapshot
  status_code: 400
  message: Coming request is missing necessary fields
  data:
    snapshot_id: test_snapshot

create an snapshot with an invalid agent_id:
  method: POST
  url: /UMA/object/snapshot
  status_code: 404
  message: Cannot find the agent id
  data:
    agent_id: abc
    snapshot_id: test_snapshot

create an snapshot:
  method: POST
  url: /UMA/object/snapshot
  status_code: 201
  data:
    agent_id: test_agent
    snapshot_id: test_snapshot

create snapshot duplicate:
  method: POST
  url: /UMA/object/snapshot
  status_code: 409
  message: Cannot create a duplicate snapshot
  data:
    agent_id: test_agent
    snapshot_id: test_snapshot

get snapshot info before:
  method: GET
  url: /UMA/object/snapshot
  status_code: 200
  message: Get snapshot info
  query:
    agent_id: test_agent
    snapshot_id: test_snapshot
  kwargs:
    q: 0.9
    threshold: 0.125
    auto_target: False
    propagate_mask: False
    initial_size: 0

#Implication test
create an implication, without sensors field:
  method: POST
  url: /UMA/object/snapshot/implication
  status_code: 400
  message: Coming request is missing necessary fields
  data:
    agent_id: test_agent
    snapshot_id: test_snapshot

create an implication, sensor1->sensor2 error:
  method: POST
  url: /UMA/object/snapshot/implication
  status_code: 400
  message: Cannot find the sensor
  data:
    agent_id: test_agent
    snapshot_id: test_snapshot
    from_sensor: sensor1
    to_sensor: sensor2

create sensor1:
  method: POST
  url: /UMA/object/sensor
  status_code: 201
  data:
    agent_id: test_agent
    snapshot_id: test_snapshot
    sensor_id: sensor1
    c_sid: c_sensor1
    w: []
    d: []
    diag: []

create sensor2:
  method: POST
  url: /UMA/object/sensor
  status_code: 201
  data:
    agent_id: test_agent
    snapshot_id: test_snapshot
    sensor_id: sensor2
    c_sid: c_sensor2
    w: []
    d: []
    diag: []

create an implication, sensor1->sensor2:
  method: POST
  url: /UMA/object/snapshot/implication
  status_code: 201
  message: Implication created
  data:
    agent_id: test_agent
    snapshot_id: test_snapshot
    from_sensor: sensor1
    to_sensor: sensor2

get implication from sensor1->sensor2:
  method: GET
  url: /UMA/object/snapshot/implication
  status_code: 200
  query:
    agent_id: test_agent
    snapshot_id: test_snapshot
    from_sensor: sensor1
    to_sensor: sensor2
  kwargs:
    implication: True

get implication from sensor2->sensor1:
  method: GET
  url: /UMA/object/snapshot/implication
  status_code: 200
  query:
    agent_id: test_agent
    snapshot_id: test_snapshot
    from_sensor: sensor2
    to_sensor: sensor1
  kwargs:
    implication: False

delete implication:
  method: DELETE
  url: /UMA/object/snapshot/implication
  status_code: 200
  message: Implication deleted
  data:
    agent_id: test_agent
    snapshot_id: test_snapshot
    from_sensor: sensor1
    to_sensor: sensor2

get implication after deletion:
  method: GET
  url: /UMA/object/snapshot/implication
  status_code: 200
  query:
    agent_id: test_agent
    snapshot_id: test_snapshot
    from_sensor: sensor1
    to_sensor: sensor2
  kwargs:
    implication: False

change q without giving snapshot id:
  method: PUT
  url: /UMA/object/snapshot
  status_code: 400
  message: Coming request is missing necessary fields
  query:
    agent_id: test_agent
  data:
    q: 0.123

chagne q to 'abc':
  method: PUT
  url: /UMA/object/snapshot
  status_code: 400
  message: Cannot parsing the field
  query:
    agent_id: test_agent
    snapshot_id: test_snapshot
  data:
    q: abc

change q to 0.123:
  method: PUT
  url: /UMA/object/snapshot
  status_code: 200
  query:
    agent_id: test_agent
    snapshot_id: test_snapshot
  data:
    q: 0.123

change threshold to 1.222:
  method: PUT
  url: /UMA/object/snapshot
  status_code: 200
  query:
    agent_id: test_agent
    snapshot_id: test_snapshot
  data:
    threshold: 1.222

change auto target to 2.2:
  method: PUT
  url: /UMA/object/snapshot
  status_code: 400
  message: Cannot parsing the field
  query:
    agent_id: test_agent
    snapshot_id: test_snapshot
  data:
    auto_target: 2.2

change auto target to True:
  method: PUT
  url: /UMA/object/snapshot
  status_code: 200
  query:
    agent_id: test_agent
    snapshot_id: test_snapshot
  data:
    auto_target: True

change propagate mask to True:
  method: PUT
  url: /UMA/object/snapshot
  status_code: 200
  query:
    agent_id: test_agent
    snapshot_id: test_snapshot
  data:
    propagate_mask: True

change initial size to 2:
  method: PUT
  url: /UMA/object/snapshot
  status_code: 200
  query:
    agent_id: test_agent
    snapshot_id: test_snapshot
  data:
    initial_size: 2

get snapshot info after:
  method: GET
  url: /UMA/object/snapshot
  status_code: 200
  message: Get snapshot info
  query:
    agent_id: test_agent
    snapshot_id: test_snapshot
  kwargs:
    sensors:
      - sensor: {'m': 'sensor1', 'cm': 'c_sensor1'}
      - sensor: {'m': 'sensor2', 'cm': 'c_sensor2'}
    q: 0.123
    threshold: 1.222
    auto_target: True
    propagate_mask: True
    initial_size: 2

delete snapshot without snapshot id:
  method: DELETE
  url: /UMA/object/snapshot
  status_code: 400
  message: Coming request is missing necessary fields
  data:
    agent_id: test_agent

delete snapshot with invalid id:
  method: DELETE
  url: /UMA/object/snapshot
  status_code: 404
  message: Cannot find the agent to delete
  data:
    agent_id: test_agent
    snapshot_id: test_snapshot1

delete snapshot:
  method: DELETE
  url: /UMA/object/snapshot
  status_code: 200
  data:
    agent_id: test_agent
    snapshot_id: test_snapshot

put request after delete:
  method: PUT
  url: /UMA/object/snapshot
  status_code: 404
  query:
    agent_id: test_agent
    snapshot_id: test_snapshot
  data:
    auto_target: False
  message: Cannot find the snapshot id

get request after delete:
  method: GET
  url: /UMA/object/snapshot
  status_code: 404
  message: Cannot find the snapshot id
  query:
    agent_id: test_agent
    snapshot_id: test_snapshot

clean up agent:
  method: DELETE
  url: /UMA/object/agent
  status_code: 200
  data:
    agent_id: test_agent


#######################

tests:
  - create an agent
  - create an snapshot without id
  - create an snapshot with an invalid id(number)
  - create an snapshot without agent_id
  - create an snapshot with an invalid agent_id
  - create an snapshot
  - create snapshot duplicate
  - get snapshot info before
#Implication test
  - create an implication, without sensors field
  - create an implication, sensor1->sensor2 error
  - create sensor1
  - create sensor2
  - create an implication, sensor1->sensor2
  - get implication from sensor1->sensor2
  - get implication from sensor2->sensor1
  - delete implication
  - get implication after deletion
  - change q without giving snapshot id
  - chagne q to 'abc'
  - change q to 0.123
  - change threshold to 1.222
  - change auto target to 2.2
  - change auto target to True
  - change propagate mask to True
  - change initial size to 2
  - get snapshot info after
  - delete snapshot without snapshot id
  - delete snapshot with invalid id
  - delete snapshot
  - put request after delete
  - get request after delete
  - clean up agent